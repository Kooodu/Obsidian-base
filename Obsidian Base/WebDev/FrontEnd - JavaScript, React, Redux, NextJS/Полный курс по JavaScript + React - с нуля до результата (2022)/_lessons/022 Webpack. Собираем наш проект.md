### **022 Webpack. Собираем наш проект**

Все большие проекты на JS разбиваются на различные блоки кода и эти блоки кода убирают в отдельные файлы. Дробление проекта на отдельные модули позволяет нам нормально поддерживать проект и делить логику на составные части. 
Однако мы встречаемся с той проблемой, что браузеры не понимают деление проекта на модули и поэтому за помощью нам нужно обращаться к сборщикам модулей, которые создадут один файл из множества маленьких. И уже этот единственный файл браузер сможет обработать и смочь с нам работать 

Webpack - это сборщик модулей. Он позволяет нам собрать проект, состоящий из большого количества отдельных файлов с экспортами и импортами.

Gulp - это планировщик задач. Он выполняет определённые задачи при наших определённых действиях. Например, он может компилировать препроцессоры при сохранении кода

Вот пример импорта и экспорта с использованием CommonJS:

```JS
// lib.js - export

"use strict";

function myModule() {
    this.run = function() {
        console.log('run');
    };

    this.go = function() {
        console.log('go');
    };
}

module.exports = myModule; // exports
```
```JS
// script.js - import

const myModule = require('./lib'); // import

const myModuleInstance = new myModule();
myModuleInstance.run(); // run
```

Установка Webpack:

```bash
mkdir webpack-demo
cd webpack-demo
npm init
npm install webpack webpack-cli --save-dev

// Либо
npm install // установит все зависимости из package.json
```

Для запуска паковщика модулей:

```bash
npx webpack
```

Дальше нужно перейти к настройке конфигурации вебпака:
- mode - девелопментом пользуемся, когда нужно просто работать над сайтом, а ставим продакшн, когда выпускаем сайт на продакшен (там будут модули для оптимизации кода)
- entry - указываем точку входа в программу
- output - настраивает выходной файл
- watch - следит за файлами и пересобирает проект при каждом изменении
- devtool - определяет логику сохранения карты расположения кода (лучше чекнуть документацию)
- module - устанавливает дополнительные модули (например, babel)

![](_png/Pasted%20image%2020220927120216.png)
```JSON
'use strict';

let path = require('path');

module.exports = {
  mode: 'development', // or production
  entry: './js/script.js', // входная точка
  output: {
    filename: 'bundle.js', // название выходного файла
    path: __dirname + '/js' // путь до него
  },
  watch: true,
  devtool: "source-map",
  module: {}
};
```

И вот, что нам даёт карта. Мы можем видеть оригинальный несжатый код

![](_png/Pasted%20image%2020220927121943.png)

**И как с этим всем работать?**
Нужно весь код, который мы переносим в другой модуль, обернуть в функцию и эту функцию экспортнуть.
В принимаемом файле нужно через require получить и вызывать эту функцию.
Далее просто запускаем `npx webpack` с настройками выше и получаем готовый результат

```JS
function calculator() {  
    const result = document.querySelector(".calculating__result span");
    // ...
}  
  
module.exports = calculator;
```
Ну и в самом HTML подключаем выходной файл
```HTML
<script src="js/bundle.js"></script>
```
![](_png/Pasted%20image%2020220927134037.png)

При запуске вебпака, он начинает следить за проектом и работает на постоянной основе, поэтому для работы с терминалом, нам нужно запустить второй

![](_png/Pasted%20image%2020220927135226.png)