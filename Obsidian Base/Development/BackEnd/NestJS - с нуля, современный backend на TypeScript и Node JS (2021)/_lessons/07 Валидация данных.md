
## 001 Exception filters и pipes

Когда с клиента приходят данные в API, эти данные могут быть провалидированы через Pipes

Когда мы отправляем данные на фронт, мы можем провалидировать эти данные через Exception Filters

![](_png/Pasted%20image%2020230403103650.png)

Сами http-ошибки в несте создаются через `HttpException`, который под капотом преобразуется в JSON

![](_png/Pasted%20image%2020230403103927.png)

Для реализации ==Exception filter==:
- создаём класс, который экстендится от ExceptionFilter
- Далее нужно класс обвесить декоратором `@Catch()`, в котором указать, какие ошибки будет обрабатывать фильтр
- далее будет описываться метод `catch()`, который принимает саму ошибку и контекст запроса
- далее в переменную `ctx` мы помещаем контекст запроса и из этой переменной дополнительно достаём `response` и `request`
- впоследствии мы можем модифицировать полученный `response` и обогатить его статусом и нужными данными по ошибке

Чтобы применить созданный фильтр, нужно навесить его на нужный роут через декоратор `@UseFilters()`, куда мы помещаем созданный инстанс нашего фильтра ошибок

Это приведёт к тому, что все ошибки, которые произойдут в роуте, будут попадать в наш фильтр

![](_png/Pasted%20image%2020230403104037.png)

В несте уже есть набор готовых пайпов 

Чтобы навесить на роут пайп, нужно использовать декоратор `@UsePipe()` и передать в него нужный инстанс пайпа

Так же мы можем валидировать не полностью целые роуты, а ещё пайпить отдельные значения, просто передавая пайп вторым аргументом в декоратор параметра

Конкретно мы имеем несколько пайпов, которые позволяют преобразовать полученный с клиента ответ в нужный нам тип данных:
- `ParseIntPipe` - трансформирует полученное значение с клиента в число (на примере полученный `id` в `number`)
- `ParseBoolPipe`
- `ParseArrayPipe`
- `ParseUUIDPipe`
- `DefaultValuePipe`

![](_png/Pasted%20image%2020230403105001.png)

Сам `ValidationPipe` использует внутри себя библиотеки `class-validator` и `class-transformer`, которые позволяют перевести объект в класс и валидировать свойства данного класса

![](_png/Pasted%20image%2020230403105544.png)

Для реализации своего пайпа, нужно будет создать класс, который будет имплементироваться от интерфейса `PipeTransform` и реализовывать метод `transform()`, который принимает первым аргументом значение, а вторым метаданные (они хранят данные о месте применения пайпа, его изначальный тип и аргумент декоратора) 

![](_png/Pasted%20image%2020230403112918.png)

Но зачастую нам нужно использовать пайпы или фильтры по всему приложению. Это можно сделать в основной функции запуска приложения неста

![](_png/Pasted%20image%2020230403113216.png)

## 002 Реализация ValidationPipe







