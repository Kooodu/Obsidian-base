
Первым делом создадим проект, проинициализируем гит и нпм

![](_png/Pasted%20image%2020230713134634.png)

Далее мы уже в отдельной ветке будем настраивать вебпак. После настройки всех изменений, ветку нужно будет слить с основной.

Команды для работы с веткой будут выглядить следующим образом:

```bash
git branch webpack
// переходим в отдельную ветку
git checkout webpack

// работаем с веткой
git add .
git commit...

// заливаем изменения на нужную ветку
git push -u origin webpack
```

Выделим отдельно типы данных, которые опишут данные конфига

`config > build > types > config.ts`
```TS
export type BuildMode = 'production' | 'development';

export interface BuildPaths {
	context: string;
	entry: string;
	build: string;
	html: string;
}

export interface BuildEnv {
	mode: BuildMode;
	port: number;
}

export interface BuildOptions {
	mode: BuildMode;
	paths: BuildPaths;
	isDev: boolean;
	port: number;
}
```

Эта функция будет собирать плагины для проекта

`config > build > buildPlugins.ts`
```TS
import { WebpackPluginInstance, ProgressPlugin } from 'webpack';
import { BuildOptions } from './types/config';
import HtmlWebpackPlugin from 'html-webpack-plugin';
import MiniCssExtractPlugin from 'mini-css-extract-plugin';
import CopyPlugin from 'copy-webpack-plugin';

export function buildPlugins({ paths, isDev }: BuildOptions): WebpackPluginInstance[] {
	return [
		new ProgressPlugin(),
		new HtmlWebpackPlugin({
			template: paths.html,
			minify: {
				removeComments: !isDev,
				collapseWhitespace: !isDev,
			},
		}),
		new MiniCssExtractPlugin({
			filename: 'css/[name].[contenthash:8].css',
			chunkFilename: 'css/[name].[contenthash:8].css',
		}),
		// плагин для копирования файлов
		new CopyPlugin({
			patterns: [
				// копируем фавикон из паблика в папку с index.html
				{
					from: 'public/favicon.ico',
					to: '',
				},
			],
		}),
	];
}
```

Эта функция будет собирать лоадеры для проекта

`config > build > buildLoaders.ts`
```TS
import { RuleSetRule } from 'webpack';
import MiniCssExtractPlugin from 'mini-css-extract-plugin';
import { BuildOptions } from './types/config';

export function buildLoaders({ isDev }: BuildOptions): RuleSetRule[] {
	const typescriptLoader = {
		test: /\.tsx?$/,
		use: 'ts-loader',
		exclude: /node_modules/,
	};

	const stylesLoader = {
		test: /\.s[ac]ss$/i,
		use: [
			// в зависимости от режима разработки будет применяться разный лоадер
			isDev ? 'style-loader' : MiniCssExtractPlugin.loader,
			// так же лоадеры можно передавать в виде объектов, если нужно к ним добавить опции
			{
				loader: 'css-loader',
				options: {
					// включаем поддержку модулей у лоадера
					modules: {
						// включаем модульные стили (классы с именами asdWQSsaQ) только если они содержат в названии module
						auto: (resPath: string) => !!resPath.includes('.module.'),
						localIdentName: isDev
							? '[path][name]__[local]--[hash:base64:8]'
							: '[hash:base64:8]',
					},
				},
			},
			'sass-loader',
		],
	};

	const babelLoader = {
		test: /\.(?:js|mjs|cjs)$/,
		exclude: /node_modules/,
		use: {
			loader: 'babel-loader',
			options: {
				presets: [['@babel/preset-env', { targets: 'defaults' }]],
			},
		},
	};

	return [typescriptLoader, stylesLoader, babelLoader];
}
```

Эта функция будет собирать резолверы для проекта

`config > build > buildResolvers.ts`
```TS
import { ResolveOptions } from 'webpack';

export function buildResolvers(): ResolveOptions {
	return {
		extensions: ['.js', '.ts', 'tsx', '.scss'],
		alias: {
			'@': '.',
			'@core': '/core',
		},
	};
}
```

Эта функция будет собирать конфиг для девсервера

`config > build > buildDevServer.ts`
```TS
import { BuildOptions } from './types/config';
import { Configuration } from 'webpack-dev-server';

export function buildDevServer(options: BuildOptions): Configuration {
	return {
		port: options.port,
		hot: options.isDev,
	};
}
```

Эта функция будет собирать конфиг вебпака

`config > build > buildWebpackConfig.ts`
```TS
import { Configuration } from 'webpack';
import { BuildOptions } from './types/config';
import { buildLoaders } from './buildLoaders';
import { buildResolvers } from './buildResolvers';
import { buildPlugins } from './buildPlugins';
import { buildDevServer } from './buildDevServer';

export function buildWebpackConfig(options: BuildOptions): Configuration {
	const { mode, paths, isDev } = options;

	return {
		mode: 'development',
		// тут задаётся контекст, где будут искаться файлы в дальнейших свойствах
		context: paths.context,
		// тут можно не писать path.resolve и искать файл по абсолютному пути, так как задан контекст
		entry: paths.entry,
		module: {
			rules: buildLoaders(options),
		},
		output: {
			filename: '[name].[contenthash].js',
			path: paths.build,
			clean: true,
		},
		resolve: buildResolvers(),
		plugins: buildPlugins(options),
		devtool: isDev ? 'inline-source-map' : undefined,
		devServer: isDev ? buildDevServer(options) : undefined,
	};
}
```

Эта функция будет возвращать конфиг вебпака, а так же в ней хранятся основные изменяемые данные проекта

`webpack.config.ts`
```TS
import path from 'path';
import { Configuration } from 'webpack';
import { BuildEnv, BuildPaths } from './config/build/types/config';
import { buildWebpackConfig } from './config/build/buildWebpackConfig';

export default (env: BuildEnv): Configuration => {
	const paths: BuildPaths = {
		entry: './index.ts',
		build: path.resolve(__dirname, 'build'),
		context: path.resolve(__dirname, 'src'),
		html: 'public/index.html',
	};

	const mode = env.mode || 'development';
	const isDev = mode === 'development';
	const PORT = env.port || 3000;

	return buildWebpackConfig({ mode, paths, isDev, port: PORT });
};
```

Подключение стилей приложение, подключение других файлов

`src > index.ts`
```TS
import './scss/index.scss';
import './module';

console.log('workink');
```

Итог проекта:

![](_png/Pasted%20image%2020230713174114.png)

После всех проведённых изменений в проекте и пуше в ветку, нам нужно объединить ветки

![](_png/Pasted%20image%2020230713171311.png)

И потом все изменения можно смёрджить

![](_png/Pasted%20image%2020230713173240.png)






