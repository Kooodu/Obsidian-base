#SSR #NextJS 
## 001 Переменные окружения

Переменные окружения хранят в себе значения, к которым мы можем получить доступ как из фронта, так и из бэка. 
Данные переменные могут хранить разные значения, например, домен. Домен для тестов, бека и фронта может быть разный и поэтому мы можем хранить разные значения. 

![](_png/Pasted%20image%2020230122172149.png)

Внутри переменных окружения можно использовать другие переменные

![](_png/Pasted%20image%2020230122172250.png)

Типы `.env` файлов

![](_png/Pasted%20image%2020230122172456.png)

Доступны переменные на сервере и доступны на фронте с приставкой `NEXT_PUBLIC_`

![](_png/Pasted%20image%2020230122172712.png)

Так же в нексте существуют отдельные функции для работы с переменными окружения

![](_png/Pasted%20image%2020230122172838.png)

Создадим файл с локальными данными окружения и запишем в него домен

`.emv.local`
```env
NEXT_PUBLIC_DOMAIN=https://owltop.ru
```

## 002 Как работает SSR

Стандартно процесс рендеринга страницы начинается с прогрузки `HTML` затем `CSS` и уже только после `JS`

![](_png/Pasted%20image%2020230122183208.png)

В текущих реалиях использования SPA, у нас грузится сначала всегда наш JS код, который и формирует приложение

![](_png/Pasted%20image%2020230122183324.png)

`Client-side Rendering` представляет из себя стандартную модель рендеринга страницы, которая отправляет клиенту весь код и собирает страницу на его ПК.
`Server-side Rendering` представляет из себя более прогрессивный способ генерации приложения, который позволяет рендерить страницу для каждого пользователя отдельно.
Плюсом является то, что `SSR` позволяет гораздо быстрее загрузить страницу, но так же он и нагружает сильно сервер, так как мы рендерим страницу для каждого пользователя на каждый его запрос

![](_png/Pasted%20image%2020230122183516.png)

==Гидратация== - это процесс, во время которого `JS` проходится по `HTML` и добавляет в него все недостающие элементы (обработчики, методы, элементы), не меняя структуру страницы, которую уже имеет пользователь.
Зачастую гидратация происходит на базе `nodeJS` - конкретно на движке `V8`

![](_png/Pasted%20image%2020230122184212.png)

>[!warning] Минусы SSR:
> - Первым делом, что нужно отметить, так это то, чтобы сохранить мощности сервера, зачастую используется кеширование данных, которые сервер уже успел отрендерить и отдать клиенту
> - Приложение становится интерактивным только после гидратации
> - Рендеринг на сервере очень сложно реализуемая процедура, которую настроить самому будет затратно по времени. Вместо этого используются фреймворки по типу `NextJS` и `NuxtJS`
> 
![](_png/Pasted%20image%2020230122184204.png)

>[!info] Преймущества, которые даёт SSR:
> - Огромный прирост к SEO
> 	- + к производительности
> 	- Лучше ответ от сервера
> 	- Отсутствие костылей в индексации SPA
> - Конечный пользователь видит первую отрисовку намного быстрее
> - Нагрузка от слабых устройств переходит на сильный сервер
>
>![](_png/Pasted%20image%2020230122190141.png)

Если мы работаем с `CSR`, то наша структура для оптимизации SEO выглядит так:
- Запрос отправляется на NGINX
- NGINX определяет бот это или пользователь
- Если пользователь, то ему грузится SPA
- Если бот, то отправляется запрос в prerender
- prerender отправляет запрос на генерацию HTML в SPA и тот возвращает сгенерированный код

![](_png/Pasted%20image%2020230122190759.png)




## 003 SSR в NextJS









## 004 Использование getStaticProps









## 005 Использование getStaticPaths





