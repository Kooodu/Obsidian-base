## 062 Обзор архитектуры

Предобработчиком нашего запроса будет `middleware`, который уже будет передавать данные на обработку в контроллер. 

Контроллер непосредственно обрабатывает запросы от пользователей.

С точки зрения слоёной архитекторы, вся бизнес-логика должна содержаться в сервисах. Сам контроллер должен просто вызвать сервис. Сервис уже сам общается с репозиторием.

Репозиторий отвечает за непосредственное общение с базой данных.

![](_png/Pasted%20image%2020221126115033.png)

Эта архитектура позволяет легко заменять определённые технологии. Например, поменяем нашу базу данных - нам придётся поменять только логику репозитория.

Так же эту систему будет легко поддерживать, так как вся логика для отдельного модуля содержится в этом одном модуле. Если нужно будет поменять сервис, то нам нужно будет править только сервис.

## 063 Пишем класс приложения

Напишем скрипты для запуска нашего приложения

`package.json`
```JSON
"main": "index.js",
  "type": "commonjs",
  "scripts": {
    "start": "node ./dist/main.js",
    "build": "tsc",
    "test": ""
  },
```

Далее настраиваем ==TS==

`tsconfig.json`
```JSON
"compilerOptions": {
	"target": "es2022", 
	"experimentalDecorators": true,
	"emitDecoratorMetadata": true,
	"module": "CommonJS", 
	"moduleResolution": "node",
	"outDir": "./dist",
}
```

Тут мы инициализируем наше приложение и запускаем

`main.ts`
```TS
import { App } from "./app";

// фукнция запуска приложения
async function bootstrap() {
	const app = new App();
	await app.init();
}

bootstrap();
```

Тут мы будет располагаться класс нашего приложения, через который будет происходить запуск всех компонентов

`app.ts`
```TS
import express, { Express, Request, Response, NextFunction } from "express";
import { Server } from "http";
import { userRouter } from "./users/users";

// класс с нашим приложением
export class App {
	app: Express;
	server: Server;
	port: number;

	constructor() {
		this.app = express();
		this.port = 8000;
		this.server = new Server();
	}

	// тут мы будем вдальнейшем определять подключенные роуты
	useRoutes() {
		this.app.use("/users", userRouter);
	}

	// тут будет происходить инициализация нашего приложения
	public async init() {
		this.useRoutes();
		this.server = this.app.listen(this.port);
		console.log(`Сервер запущен на http://localhost:${this.port}`);
	}
}
```


## 064 Добавляем логгер







## 065 Базовый класс контроллера







## 066 Упражнение - Контроллер пользователей







## 067 Обработка ошибок







